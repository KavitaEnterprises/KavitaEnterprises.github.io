<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Product Details - FinGaurd Water Purifiers</title>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<script>
			tailwind.config = {
				theme: {
					extend: {
						colors: {
							primary: '#2563eb',
							secondary: '#54e8e8',
							'primary-dark': '#1e40af'
						},
						fontFamily: {
							sans: ['Urbanist', 'system-ui', 'sans-serif'],
							display: ['Bebas Neue', 'Urbanist', 'sans-serif'],
							body: ['Urbanist', 'system-ui', 'sans-serif']
						}
					}
				}
			}
		</script>

		<!-- Custom CSS -->
		<link rel="stylesheet" href="/css/style.css" />
		<script src="/js/cart.js"></script>

		<style>
			/* Loading skeleton animation */
			@keyframes shimmer {
				0% { background-position: -1000px 0; }
				100% { background-position: 1000px 0; }
			}
			.skeleton {
				background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
				background-size: 1000px 100%;
				animation: shimmer 2s infinite;
			}
		</style>
	</head>
	<body class="font-body antialiased text-gray-900 bg-gray-50">
		<header></header>

		<main class="pt-16 lg:pt-20">
			<!-- Loading State -->
			<div id="loading-state" class="min-h-screen flex items-center justify-center">
				<div class="text-center">
					<div class="inline-block animate-spin rounded-full h-16 w-16 border-4 border-primary border-t-transparent"></div>
					<p class="mt-4 text-gray-600 font-medium">Loading product details...</p>
				</div>
			</div>

			<!-- Product Not Found -->
			<div id="not-found-state" class="hidden min-h-screen flex items-center justify-center">
				<div class="text-center max-w-md mx-auto px-4">
					<span class="material-symbols-rounded text-9xl text-gray-300 mb-4 block">error_outline</span>
					<h2 class="text-3xl font-bold text-gray-900 mb-4">Product Not Found</h2>
					<p class="text-gray-600 mb-8">The product you're looking for doesn't exist or has been removed.</p>
					<a href="/products.html" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-xl hover:bg-primary-dark transition-colors">
						<span class="material-symbols-rounded">arrow_back</span>
						Back to Products
					</a>
				</div>
			</div>

			<!-- Product Content -->
			<div id="product-content" class="hidden">
				<!-- Breadcrumb -->
				<section class="bg-white border-b border-gray-200">
					<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
						<nav class="flex items-center gap-2 text-sm text-gray-500">
							<a href="/index.html" class="hover:text-primary transition-colors">Home</a>
							<span class="material-symbols-rounded text-gray-400 text-sm">chevron_right</span>
							<a href="/products.html" class="text-gray-500 hover:text-primary transition-colors">Products</a>
							<span class="material-symbols-rounded text-gray-400 text-sm">chevron_right</span>
							<span id="breadcrumb-category" class="text-gray-500 hover:text-primary transition-colors cursor-pointer">Category</span>
							<span class="material-symbols-rounded text-gray-400 text-sm">chevron_right</span>
							<span id="breadcrumb-name" class="text-gray-700 font-medium">Product</span>
						</nav>
					</div>
				</section>

				<!-- Product Details -->
				<section class="py-8 lg:py-12">
					<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
						<div class="grid grid-cols-1 lg:grid-cols-2 gap-8 lg:gap-12">
							<!-- Product Image -->
							<div class="space-y-4">
								<div id="product-gallery" class="relative bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden aspect-square flex items-center justify-center">
									<button type="button" id="gallery-prev" class="absolute left-3 top-1/2 -translate-y-1/2 p-2 bg-white/90 backdrop-blur rounded-full border border-gray-200 shadow hover:bg-primary/10 text-gray-600 hover:text-primary transition-colors" aria-label="Show previous product image">
										<span class="material-symbols-rounded">chevron_left</span>
									</button>
									<img id="product-image" src="" alt="" class="w-full h-full object-contain p-6 sm:p-8" />
									<button type="button" id="gallery-next" class="absolute right-3 top-1/2 -translate-y-1/2 p-2 bg-white/90 backdrop-blur rounded-full border border-gray-200 shadow hover:bg-primary/10 text-gray-600 hover:text-primary transition-colors" aria-label="Show next product image">
										<span class="material-symbols-rounded">chevron_right</span>
									</button>
									<div id="product-badge" class="absolute top-4 right-4"></div>
								</div>

								<div id="product-thumbnails" class="grid grid-cols-4 gap-3"></div>

								<div class="relative">
									<div class="grid grid-cols-2 gap-4">
										<button id="share-button" type="button" class="flex items-center justify-center gap-2 px-4 py-3 bg-white border border-gray-300 rounded-xl hover:border-primary hover:text-primary transition-colors">
											<span class="material-symbols-rounded">share</span>
											<span class="font-medium">Share</span>
										</button>
										<button id="save-button" type="button" class="flex items-center justify-center gap-2 px-4 py-3 bg-white border border-gray-300 rounded-xl hover:border-primary hover:text-primary transition-colors">
											<span class="material-symbols-rounded" data-favorite-icon>favorite_border</span>
											<span class="font-medium" data-favorite-label>Save</span>
										</button>
									</div>

									<div id="share-dropdown" class="hidden absolute left-0 mt-2 w-72 bg-white border border-gray-200 rounded-xl shadow-2xl py-3 z-30">
										<div class="px-4 pb-2 text-xs font-semibold text-gray-500 uppercase tracking-wide">Share via</div>
										<div class="px-2 space-y-1">
											<button type="button" class="share-option w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 text-sm font-medium text-gray-700" data-platform="whatsapp">
												<span class="material-symbols-rounded text-primary">chat</span>
												<span>WhatsApp</span>
											</button>
											<button type="button" class="share-option w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 text-sm font-medium text-gray-700" data-platform="sms">
												<span class="material-symbols-rounded text-primary">sms</span>
												<span>Message</span>
											</button>
											<button type="button" class="share-option w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 text-sm font-medium text-gray-700" data-platform="telegram">
												<span class="material-symbols-rounded text-primary">send</span>
												<span>Telegram</span>
											</button>
											<button type="button" class="share-option w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 text-sm font-medium text-gray-700" data-platform="facebook">
												<span class="material-symbols-rounded text-primary">public</span>
												<span>Facebook</span>
											</button>
											<button type="button" class="share-option w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 text-sm font-medium text-gray-700" data-platform="instagram">
												<span class="material-symbols-rounded text-primary">photo_camera</span>
												<span>Instagram</span>
											</button>
											<button type="button" class="share-option w-full flex items-center gap-3 px-3 py-2 rounded-lg hover:bg-primary/10 text-sm font-medium text-gray-700" data-platform="x">
												<span class="material-symbols-rounded text-primary">alternate_email</span>
												<span>X.com</span>
											</button>
										</div>
									</div>
								</div>
							</div>

							<!-- Product Info -->
							<div class="space-y-6">
								<!-- Header -->
								<div>
									<div class="flex items-center gap-2 mb-2">
										<span id="product-sku" class="text-sm text-gray-500 font-mono">SKU-0000</span>
										<span class="w-1 h-1 bg-gray-300 rounded-full"></span>
										<span id="product-stock" class="text-sm text-green-600 font-medium">In Stock</span>
									</div>
									<h1 id="product-name" class="text-3xl lg:text-4xl font-bold text-gray-900 mb-3">Product Name</h1>
									<p id="product-description" class="text-gray-600 leading-relaxed">Product description...</p>
								</div>

								<!-- Tags -->
								<div id="product-tags" class="flex flex-wrap gap-2"></div>

								<!-- Price & CTA -->
								<div class="bg-gradient-to-br from-blue-50 to-indigo-50 border border-blue-200 rounded-xl p-6">
									<div class="flex items-end gap-3 mb-4">
										<span class="text-4xl font-bold text-primary">₹<span id="product-price">0</span></span>
										<span class="text-gray-500 line-through text-lg">₹<span id="product-mrp">0</span></span>
										<span id="product-discount" class="px-3 py-1 bg-green-500 text-white text-sm font-bold rounded-full"></span>
									</div>
									<p class="text-sm text-gray-600 mb-4">Inclusive of all taxes • Free Installation</p>
									<div class="flex flex-col sm:flex-row gap-3">
										<button id="add-to-cart-btn" data-cart-feedback class="flex-1 flex items-center justify-center gap-2 px-6 py-4 bg-primary text-white rounded-xl hover:bg-primary-dark transition-all hover:shadow-lg group">
											<span class="material-symbols-rounded">shopping_cart</span>
											<span class="font-semibold">Add to Cart</span>
										</button>
										<button class="px-6 py-4 bg-white border-2 border-primary text-primary rounded-xl hover:bg-primary hover:text-white transition-all">
											<span class="material-symbols-rounded">call</span>
										</button>
									</div>
								</div>

								<!-- Prepaid Discount Promotional Card - Compact -->
								<div class="relative overflow-hidden bg-gradient-to-br from-emerald-600 via-green-600 to-teal-600 rounded-xl shadow-xl">
									<!-- Decorative Elements -->
									<div class="absolute inset-0 opacity-10" style="background-image: url('data:image/svg+xml,%3Csvg width=&quot;60&quot; height=&quot;60&quot; viewBox=&quot;0 0 60 60&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot;%3E%3Cg fill=&quot;none&quot; fill-rule=&quot;evenodd&quot;%3E%3Cg fill=&quot;%23ffffff&quot; fill-opacity=&quot;0.4&quot;%3E%3Cpath d=&quot;M36 34v-4h-2v4h-4v2h4v4h2v-4h4v-2h-4zm0-30V0h-2v4h-4v2h4v4h2V6h4V4h-4zM6 34v-4H4v4H0v2h4v4h2v-4h4v-2H6zM6 4V0H4v4H0v2h4v4h2V6h4V4H6z&quot;/%3E%3C/g%3E%3C/g%3E%3C/svg%3E');"></div>
									
									<div class="relative px-4 sm:px-5 lg:px-6 py-4 lg:py-5">
										<!-- Header -->
										<div class="flex flex-col sm:flex-row items-center justify-between gap-3 mb-4 lg:mb-5">
											<div class="flex items-center gap-3">
												<div class="w-10 h-10 lg:w-12 lg:h-12 bg-white/20 backdrop-blur-sm rounded-xl flex items-center justify-center">
													<span class="material-symbols-rounded text-white text-2xl lg:text-3xl">local_offer</span>
												</div>
												<div class="text-center sm:text-left">
													<div class="inline-flex items-center gap-1 px-2.5 py-0.5 bg-yellow-400 rounded-full mb-1">
														<span class="material-symbols-rounded text-yellow-900 text-xs">bolt</span>
														<span class="text-[10px] font-bold text-yellow-900 uppercase tracking-wide">Limited Offer</span>
													</div>
													<h3 class="text-lg lg:text-xl font-bold text-white leading-tight">
														Prepaid Discounts Available
													</h3>
												</div>
											</div>
											<div class="flex items-center gap-1.5 px-3 py-1.5 bg-white/15 backdrop-blur-sm rounded-lg border border-white/20">
												<span class="material-symbols-rounded text-white text-lg">savings</span>
												<span class="text-white font-bold text-xs lg:text-sm">Up to ₹250 OFF</span>
											</div>
										</div>
										
										<!-- Discount Cards -->
										<div class="grid grid-cols-1 sm:grid-cols-2 gap-3 lg:gap-4 mb-3 lg:mb-4">
											<!-- Card 1 -->
											<div class="bg-white rounded-xl p-3 lg:p-4 shadow-lg hover:shadow-xl transition-shadow">
												<div class="flex items-center gap-2.5 mb-2.5">
													<div class="w-10 h-10 bg-gradient-to-br from-emerald-500 to-green-600 rounded-lg flex items-center justify-center flex-shrink-0">
														<span class="material-symbols-rounded text-white text-xl">shopping_bag</span>
													</div>
													<div class="flex-1 min-w-0">
														<p class="text-[10px] lg:text-xs text-gray-500 font-semibold uppercase tracking-wide">Orders up to ₹5K</p>
														<h4 class="text-2xl lg:text-3xl font-black bg-gradient-to-r from-emerald-600 to-green-600 bg-clip-text text-transparent leading-tight">
															5% OFF
														</h4>
													</div>
												</div>
												<div class="bg-emerald-50 border border-emerald-200 rounded-lg px-2.5 py-1.5">
													<p class="text-[10px] lg:text-xs text-emerald-800 font-bold">
														<span class="material-symbols-rounded text-xs align-middle">info</span> Max discount: ₹100
													</p>
												</div>
											</div>
											
											<!-- Card 2 -->
											<div class="relative bg-white rounded-xl p-3 lg:p-4 shadow-lg hover:shadow-xl transition-shadow">
												<div class="absolute top-2 right-2 px-2 py-0.5 bg-gradient-to-r from-teal-600 to-cyan-600 rounded-md shadow-sm">
													<span class="text-[9px] font-bold text-white uppercase tracking-wide">Best Value</span>
												</div>
												<div class="flex items-center gap-2.5 mb-2.5">
													<div class="w-10 h-10 bg-gradient-to-br from-teal-500 to-cyan-600 rounded-lg flex items-center justify-center flex-shrink-0">
														<span class="material-symbols-rounded text-white text-xl">diamond</span>
													</div>
													<div class="flex-1 min-w-0">
														<p class="text-[10px] lg:text-xs text-gray-500 font-semibold uppercase tracking-wide">Orders above ₹5K</p>
														<h4 class="text-2xl lg:text-3xl font-black bg-gradient-to-r from-teal-600 to-cyan-600 bg-clip-text text-transparent leading-tight">
															₹250 OFF
														</h4>
													</div>
												</div>
												<div class="bg-teal-50 border border-teal-200 rounded-lg px-2.5 py-1.5">
													<p class="text-[10px] lg:text-xs text-teal-800 font-bold">
														<span class="material-symbols-rounded text-xs align-middle">verified</span> Flat discount - No cap!
													</p>
												</div>
											</div>
										</div>
										
										<!-- Instructions -->
										<div class="bg-white/10 backdrop-blur-sm rounded-lg border border-white/20 px-3 py-2 lg:py-2.5">
											<div class="flex flex-col sm:flex-row items-center gap-2 sm:gap-3 text-center sm:text-left">
												<span class="material-symbols-rounded text-yellow-300 text-lg flex-shrink-0">info</span>
												<p class="text-[11px] lg:text-xs text-white/95 font-medium leading-relaxed">
													<span class="font-bold">How to claim:</span> Add to cart → Message us on WhatsApp → Pay discounted price
												</p>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Key Highlights - Full Width -->
						<div class="mt-8 lg:mt-10">
							<div class="bg-white border border-gray-200 rounded-xl p-6">
								<h3 class="text-lg font-bold text-gray-900 mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">verified</span>
									Key Highlights
								</h3>
								<div id="key-highlights" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-3">
									<!-- Dynamic content -->
								</div>
							</div>
						</div>

						<!-- Detailed Information Tabs -->
						<div class="mt-12">
							<div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
								<!-- Tab Headers -->
								<div class="border-b border-gray-200 overflow-x-auto">
									<nav class="flex min-w-max">
										<button class="tab-button active px-6 py-4 text-sm font-semibold border-b-2 border-primary text-primary transition-colors" data-tab="specifications">
											<span class="flex items-center gap-2">
												<span class="material-symbols-rounded text-lg">settings</span>
												Specifications
											</span>
										</button>
										<button class="tab-button px-6 py-4 text-sm font-semibold border-b-2 border-transparent text-gray-600 hover:text-gray-900 transition-colors" data-tab="features">
											<span class="flex items-center gap-2">
												<span class="material-symbols-rounded text-lg">star</span>
												Features
											</span>
										</button>
										<button class="tab-button px-6 py-4 text-sm font-semibold border-b-2 border-transparent text-gray-600 hover:text-gray-900 transition-colors" data-tab="water-quality">
											<span class="flex items-center gap-2">
												<span class="material-symbols-rounded text-lg">water_drop</span>
												Water Quality
											</span>
										</button>
										<button class="tab-button px-6 py-4 text-sm font-semibold border-b-2 border-transparent text-gray-600 hover:text-gray-900 transition-colors" data-tab="warranty">
											<span class="flex items-center gap-2">
												<span class="material-symbols-rounded text-lg">verified_user</span>
												Warranty & Support
											</span>
										</button>
									</nav>
								</div>

								<!-- Tab Content -->
								<div class="p-6 lg:p-8">
									<!-- Specifications Tab -->
									<div id="tab-specifications" class="tab-content">
										<h3 class="text-2xl font-bold text-gray-900 mb-6">Technical Specifications</h3>
										<div id="specifications-content" class="grid grid-cols-1 md:grid-cols-2 gap-4">
											<!-- Dynamic content -->
										</div>
									</div>

									<!-- Features Tab -->
									<div id="tab-features" class="tab-content hidden">
										<h3 class="text-2xl font-bold text-gray-900 mb-6">Features & Capabilities</h3>
										<div id="features-content" class="space-y-6">
											<!-- Dynamic content -->
										</div>
									</div>

									<!-- Water Quality Tab -->
									<div id="tab-water-quality" class="tab-content hidden">
										<h3 class="text-2xl font-bold text-gray-900 mb-6">Water Quality Parameters</h3>
										<div id="water-quality-content" class="grid grid-cols-1 md:grid-cols-2 gap-6">
											<!-- Dynamic content -->
										</div>
									</div>

									<!-- Warranty Tab -->
									<div id="tab-warranty" class="tab-content hidden">
										<h3 class="text-2xl font-bold text-gray-900 mb-6">Warranty & Support</h3>
										<div id="warranty-content" class="space-y-6">
											<!-- Dynamic content -->
										</div>
									</div>
								</div>
							</div>
						</div>

						<!-- Related Products -->
						<div class="mt-12">
							<div class="flex items-center justify-between mb-6">
								<h2 class="text-2xl lg:text-3xl font-bold text-gray-900">Related Products</h2>
								<a href="/products.html" class="text-primary hover:text-primary-dark font-semibold flex items-center gap-1 group">
									View All
									<span class="material-symbols-rounded group-hover:translate-x-1 transition-transform">arrow_forward</span>
								</a>
							</div>
							<div id="related-products" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
								<!-- Dynamic content -->
							</div>
						</div>
					</div>
				</section>
			</div>
		</main>

		<footer></footer>

		<!-- Product Loading Script -->
		<script>
			let currentProduct = null;
			let allProducts = [];
			let galleryImages = [];
			let currentGalleryIndex = 0;

			// Get product ID from URL
			function getProductId() {
				const urlParams = new URLSearchParams(window.location.search);
				return urlParams.get('id');
			}

			// Load product data
			async function loadProduct() {
				try {
					const productId = getProductId();
					console.log('Loading product with ID:', productId);
					
					if (!productId) {
						console.error('No product ID provided in URL');
						showNotFound();
						return;
					}

					const response = await fetch('data/products.json');
					if (!response.ok) {
						throw new Error(`HTTP error! status: ${response.status}`);
					}
					allProducts = await response.json();
					console.log('Loaded products:', allProducts.length);
					
					currentProduct = allProducts.find(p => p.id === parseInt(productId));
					console.log('Found product:', currentProduct);
					
					if (!currentProduct) {
						console.error('Product not found with ID:', productId);
						showNotFound();
						return;
					}

					displayProduct(currentProduct);
					displayRelatedProducts(currentProduct);
					
					document.getElementById('loading-state').style.display = 'none';
					document.getElementById('product-content').classList.remove('hidden');
					
				} catch (error) {
					console.error('Failed to load product:', error);
					showNotFound();
				}
			}

			// Show not found state
			function showNotFound() {
				document.getElementById('loading-state').style.display = 'none';
				document.getElementById('not-found-state').classList.remove('hidden');
			}

			// Display product details
			function displayProduct(product) {
				// Update document title
				document.title = `${product.name} - FinGaurd`;

				// Breadcrumb
				document.getElementById('breadcrumb-category').textContent = product.category;
				document.getElementById('breadcrumb-category').onclick = () => {
					window.location.href = `/products.html?category=${encodeURIComponent(product.category)}`;
				};
				document.getElementById('breadcrumb-name').textContent = product.name;

				// Gallery & Basic Info
				galleryImages = Array.isArray(product.images) && product.images.length
					? product.images
					: ['assets/images/placeholder.jpg'];
				currentGalleryIndex = 0;
				renderGallery(product.name);

				document.getElementById('product-name').textContent = product.name;
				document.getElementById('product-sku').textContent = product.sku;
				document.getElementById('product-description').textContent = product.description;

				// Badge
				const badgeColor = getCategoryBadgeColor(product.category);
				document.getElementById('product-badge').innerHTML = `
					<span class="inline-flex items-center gap-1 px-3 py-1.5 ${badgeColor} text-white text-xs font-bold rounded-full shadow-lg">
						<span class="material-symbols-rounded text-sm">verified</span>
						${product.category}
					</span>
				`;

				// Tags
				if (product.tags && product.tags.length > 0) {
					document.getElementById('product-tags').innerHTML = product.tags.map(tag => `
						<span class="px-3 py-1 bg-gray-100 text-gray-700 text-sm rounded-full border border-gray-200">
							${tag}
						</span>
					`).join('');
				}

				// Price with real MRP/Selling Price
				const sellingPrice = product.sellingPrice || product.price || 0;
				const mrp = product.mrp || (sellingPrice * 1.2); // Use real MRP if available, else calculate
				const discount = mrp > sellingPrice ? Math.round(((mrp - sellingPrice) / mrp) * 100) : 0;
				
				document.getElementById('product-price').textContent = sellingPrice.toLocaleString('en-IN');
				document.getElementById('product-mrp').textContent = mrp.toLocaleString('en-IN');
				document.getElementById('product-discount').textContent = discount > 0 ? `${discount}% OFF` : 'Best Price';

				// Key Highlights
				const highlights = [];
				if (product.specifications?.storageCapacity) highlights.push({ icon: 'water', text: product.specifications.storageCapacity });
				if (product.specifications?.purificationStages) highlights.push({ icon: 'filter_alt', text: `${product.specifications.purificationStages} Stages` });
				if (product.specifications?.purificationTechnology) highlights.push({ icon: 'science', text: product.specifications.purificationTechnology.join('+') });
				if (product.specifications?.warrantyPeriod) highlights.push({ icon: 'verified_user', text: product.specifications.warrantyPeriod });

				document.getElementById('key-highlights').innerHTML = highlights.map(h => `
					<div class="flex items-center gap-3 p-3 bg-gray-50 rounded-lg border border-gray-200">
						<span class="material-symbols-rounded text-primary text-xl">${h.icon}</span>
						<span class="text-sm font-medium text-gray-700">${h.text}</span>
					</div>
				`).join('');

				// Specifications
				if (product.specifications) {
					document.getElementById('specifications-content').innerHTML = Object.entries(product.specifications)
						.map(([key, value]) => {
							const displayKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
							let displayValue = value;
							
							if (Array.isArray(value)) {
								displayValue = value.join(', ');
							} else if (typeof value === 'boolean') {
								displayValue = value ? 'Yes' : 'No';
							}
							
							return `
								<div class="flex items-start gap-3 p-4 bg-gray-50 rounded-lg border border-gray-200">
									<span class="material-symbols-rounded text-primary text-xl flex-shrink-0">check_circle</span>
									<div>
										<div class="font-semibold text-gray-900">${displayKey}</div>
										<div class="text-sm text-gray-600 mt-1">${displayValue}</div>
									</div>
								</div>
							`;
						}).join('');
				}

				// Features
				if (product.features) {
					const featureGroups = Object.entries(product.features).map(([key, items]) => {
						const displayKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
						const icon = key.includes('removal') ? 'shield' : key.includes('smart') ? 'psychology' : key.includes('safety') ? 'security' : 'build';
						
						return `
							<div class="bg-gray-50 rounded-lg border border-gray-200 p-6">
								<h4 class="font-bold text-gray-900 mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">${icon}</span>
									${displayKey}
								</h4>
								<ul class="space-y-2">
									${items.map(item => `
										<li class="flex items-start gap-2 text-gray-700">
											<span class="material-symbols-rounded text-green-500 text-sm mt-0.5">check</span>
											<span class="text-sm">${item}</span>
										</li>
									`).join('')}
								</ul>
							</div>
						`;
					}).join('');
					
					document.getElementById('features-content').innerHTML = featureGroups;
				}

				// Water Quality
				if (product.waterQuality) {
					document.getElementById('water-quality-content').innerHTML = Object.entries(product.waterQuality)
						.map(([key, value]) => {
							const displayKey = key.replace(/([A-Z])/g, ' $1').replace(/^./, str => str.toUpperCase());
							
							return `
								<div class="bg-gradient-to-br from-blue-50 to-cyan-50 rounded-lg border border-blue-200 p-6">
									<div class="flex items-center justify-between mb-2">
										<span class="text-sm font-medium text-gray-600">${displayKey}</span>
										<span class="material-symbols-rounded text-blue-500">water_drop</span>
									</div>
									<div class="text-2xl font-bold text-blue-600">${value}</div>
								</div>
							`;
						}).join('');
				} else {
					document.getElementById('water-quality-content').innerHTML = `
						<div class="col-span-2 text-center text-gray-500 py-8">
							<span class="material-symbols-rounded text-6xl text-gray-300 mb-2 block">info</span>
							Water quality parameters not available for this product.
						</div>
					`;
				}

				// Warranty
				const warrantyContent = `
					<div class="bg-gradient-to-br from-green-50 to-emerald-50 rounded-lg border border-green-200 p-6">
						<div class="flex items-start gap-4">
							<span class="material-symbols-rounded text-green-600 text-4xl">verified_user</span>
							<div>
								<h4 class="font-bold text-gray-900 text-lg mb-2">Comprehensive Warranty</h4>
								<p class="text-gray-700">${product.specifications?.warrantyPeriod || '1 Year comprehensive warranty'}</p>
								<p class="text-sm text-gray-600 mt-2">Service life: ${product.specifications?.serviceLife || '8-10 years'}</p>
							</div>
						</div>
					</div>
					
					<div class="grid grid-cols-1 md:grid-cols-2 gap-4">
						<div class="bg-white rounded-lg border border-gray-200 p-6">
							<span class="material-symbols-rounded text-primary text-3xl mb-3 block">support_agent</span>
							<h4 class="font-bold text-gray-900 mb-2">Business Hours Support</h4>
							<p class="text-sm text-gray-600">Available 11 AM - 5 PM (Mon-Sat). 48-hour response on business days.</p>
						</div>
						
						<div class="bg-white rounded-lg border border-gray-200 p-6">
							<span class="material-symbols-rounded text-primary text-3xl mb-3 block">handyman</span>
							<h4 class="font-bold text-gray-900 mb-2">Free Installation</h4>
							<p class="text-sm text-gray-600">Professional installation included with every purchase at no extra cost.</p>
						</div>
						
						<div class="bg-white rounded-lg border border-gray-200 p-6">
							<span class="material-symbols-rounded text-primary text-3xl mb-3 block">autorenew</span>
							<h4 class="font-bold text-gray-900 mb-2">Easy Replacement</h4>
							<p class="text-sm text-gray-600">Hassle-free replacement within warranty period if needed.</p>
						</div>
						
						<div class="bg-white rounded-lg border border-gray-200 p-6">
							<span class="material-symbols-rounded text-primary text-3xl mb-3 block">local_shipping</span>
							<h4 class="font-bold text-gray-900 mb-2">Genuine Parts</h4>
							<p class="text-sm text-gray-600">Only authentic FinGaurd parts used in all services and repairs.</p>
						</div>
					</div>
				`;
			
			document.getElementById('warranty-content').innerHTML = warrantyContent;

			setupShare(product);
			setupSaveButton(product);

			// Add to cart functionality
			document.getElementById('add-to-cart-btn').addEventListener('click', (event) => {
				const price = product.sellingPrice || product.price || 0;
				Cart.addItem(
					product.id,
					product.name,
					product.sku,
					price,
					galleryImages[0],
					1,
					event.currentTarget
				);
			});
		}

		function renderGallery(productName) {
			const imageElement = document.getElementById('product-image');
			const thumbnailsContainer = document.getElementById('product-thumbnails');
			const prevButton = document.getElementById('gallery-prev');
			const nextButton = document.getElementById('gallery-next');

			if (!imageElement) return;

			const hasMultiple = galleryImages.length > 1;

			[prevButton, nextButton].forEach(button => {
				if (!button) return;
				button.classList.toggle('hidden', !hasMultiple);
				button.disabled = !hasMultiple;
				button.onclick = null;
			});

			if (hasMultiple) {
				if (prevButton) {
					prevButton.onclick = () => changeGalleryImage(-1, productName);
					prevButton.setAttribute('aria-hidden', 'false');
				}
				if (nextButton) {
					nextButton.onclick = () => changeGalleryImage(1, productName);
					nextButton.setAttribute('aria-hidden', 'false');
				}
			} else {
				if (prevButton) prevButton.setAttribute('aria-hidden', 'true');
				if (nextButton) nextButton.setAttribute('aria-hidden', 'true');
			}

			if (thumbnailsContainer) {
				if (hasMultiple) {
					thumbnailsContainer.classList.remove('hidden');
					thumbnailsContainer.innerHTML = galleryImages.map((src, index) => `
						<button type="button" class="relative aspect-square rounded-xl border ${index === currentGalleryIndex ? 'border-primary ring-2 ring-primary/40' : 'border-gray-200'} overflow-hidden bg-white hover:border-primary transition-colors" data-gallery-thumbnail="${index}" aria-label="Show image ${index + 1}">
							<img src="${src}" alt="${productName} thumbnail ${index + 1}" class="w-full h-full object-contain p-2" />
						</button>
					`).join('');
					thumbnailsContainer.addEventListener('click', handleThumbnailClick);
				} else {
					thumbnailsContainer.innerHTML = '';
					thumbnailsContainer.classList.add('hidden');
				}
			}

			updateGalleryDisplay(productName);
		}

		function handleThumbnailClick(event) {
			const target = event.target.closest('[data-gallery-thumbnail]');
			if (!target) return;
			const index = Number(target.dataset.galleryThumbnail);
			if (Number.isNaN(index)) return;
			currentGalleryIndex = index;
			updateGalleryDisplay(currentProduct?.name || '');
		}

		function changeGalleryImage(direction, productName) {
			if (!galleryImages.length) return;
			currentGalleryIndex = (currentGalleryIndex + direction + galleryImages.length) % galleryImages.length;
			updateGalleryDisplay(productName);
		}

		function updateGalleryDisplay(productName) {
			const imageElement = document.getElementById('product-image');
			if (!imageElement || !galleryImages.length) return;
			imageElement.src = galleryImages[currentGalleryIndex];
			imageElement.alt = `${productName} - view ${currentGalleryIndex + 1}`;

			document.querySelectorAll('[data-gallery-thumbnail]').forEach((thumb, index) => {
				const isActive = index === currentGalleryIndex;
				thumb.classList.toggle('border-primary', isActive);
				thumb.classList.toggle('ring-2', isActive);
				thumb.classList.toggle('ring-primary/40', isActive);
				thumb.classList.toggle('border-gray-200', !isActive);
			});
		}

		function setupShare(product) {
			const shareButton = document.getElementById('share-button');
			const shareDropdown = document.getElementById('share-dropdown');
			if (!shareButton || !shareDropdown) return;

			const shareUrl = window.location.href.split('#')[0];
			const shareMessage = `Check out ${product.name} from FinGaurd!`;
			const shareData = { title: product.name, text: shareMessage, url: shareUrl };

			const closeDropdown = () => {
				shareDropdown.classList.add('hidden');
				shareButton.setAttribute('aria-expanded', 'false');
			};

			const toggleDropdown = () => {
				const isHidden = shareDropdown.classList.contains('hidden');
				shareDropdown.classList.toggle('hidden');
				shareButton.setAttribute('aria-expanded', isHidden ? 'true' : 'false');
			};

			shareButton.setAttribute('aria-haspopup', 'true');
			shareButton.setAttribute('aria-expanded', 'false');

			shareButton.onclick = async () => {
				if (navigator.share) {
					try {
						await navigator.share(shareData);
						return;
					} catch (error) {
						if (error?.name === 'AbortError') {
							return;
						}
					}
				}

				toggleDropdown();
			};

			shareDropdown.querySelectorAll('.share-option').forEach(option => {
				option.onclick = () => {
					const platform = option.dataset.platform;
					const targetUrl = buildShareUrl(platform, shareData.url, shareMessage);
					if (targetUrl) {
						if (platform === 'sms') {
							window.location.href = targetUrl;
						} else {
							window.open(targetUrl, '_blank', 'noopener,noreferrer');
						}
					}
					closeDropdown();
				};
			});

			document.addEventListener('click', (event) => {
				if (!shareDropdown.classList.contains('hidden') && !event.target.closest('#share-dropdown') && !event.target.closest('#share-button')) {
					closeDropdown();
				}
			});

			document.addEventListener('keydown', (event) => {
				if (event.key === 'Escape') {
					closeDropdown();
				}
			});
		}

		function buildShareUrl(platform, url, message) {
			switch (platform) {
				case 'whatsapp':
					return `https://wa.me/?text=${encodeURIComponent(`${message} ${url}`)}`;
				case 'sms':
					return `sms:?body=${encodeURIComponent(`${message} ${url}`)}`;
				case 'telegram':
					return `https://t.me/share/url?url=${encodeURIComponent(url)}&text=${encodeURIComponent(message)}`;
				case 'facebook':
					return `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}`;
				case 'instagram':
					return `https://www.instagram.com/?url=${encodeURIComponent(url)}`;
				case 'x':
					return `https://twitter.com/intent/tweet?url=${encodeURIComponent(url)}&text=${encodeURIComponent(message)}`;
				default:
					return url;
			}
		}

		function setupSaveButton(product) {
			const saveButton = document.getElementById('save-button');
			const icon = saveButton?.querySelector('[data-favorite-icon]');
			const label = saveButton?.querySelector('[data-favorite-label]');

			if (!saveButton || !icon || !label || !window.Favorites) return;

			const updateState = (isSaved) => {
				icon.textContent = isSaved ? 'favorite' : 'favorite_border';
				icon.classList.toggle('text-pink-500', isSaved);
				saveButton.classList.toggle('border-pink-200', isSaved);
				saveButton.classList.toggle('bg-pink-50', isSaved);
				saveButton.setAttribute('aria-pressed', isSaved.toString());
				label.textContent = isSaved ? 'Saved' : 'Save';
			};

			updateState(Favorites.isSaved(product.id));

			saveButton.onclick = () => {
				const isSaved = Favorites.toggle(product.id);
				updateState(isSaved);
			};

			document.addEventListener('favorites:updated', () => {
				updateState(Favorites.isSaved(product.id));
			});
		}

		function initializeFavoriteCardButtons(root) {
			if (!root || !window.Favorites) return;
			const buttons = root.querySelectorAll('[data-product-favorite]');
			buttons.forEach(button => {
				const icon = button.querySelector('.favorite-icon');
				const productId = Number(button.dataset.productFavorite);
				if (!icon || Number.isNaN(productId)) return;

				const applyState = (isSaved) => {
					icon.textContent = isSaved ? 'favorite' : 'favorite_border';
					icon.classList.toggle('text-pink-500', isSaved);
					button.classList.toggle('bg-pink-50', isSaved);
					button.classList.toggle('border-pink-200', isSaved);
				};

				applyState(Favorites.isSaved(productId));

				button.onclick = (event) => {
					event.preventDefault();
					event.stopPropagation();
					const saved = Favorites.toggle(productId);
					applyState(saved);
				};
			});
		}

		document.addEventListener('favorites:updated', () => {
			if (!window.Favorites) return;
			document.querySelectorAll('[data-product-favorite]').forEach(button => {
				const icon = button.querySelector('.favorite-icon');
				const productId = Number(button.dataset.productFavorite);
				if (!icon || Number.isNaN(productId)) return;
				const saved = Favorites.isSaved(productId);
				icon.textContent = saved ? 'favorite' : 'favorite_border';
				icon.classList.toggle('text-pink-500', saved);
				button.classList.toggle('bg-pink-50', saved);
				button.classList.toggle('border-pink-200', saved);
			});
		});

		// Display related products
		function displayRelatedProducts(product) {
				const related = allProducts
					.filter(p => p.id !== product.id && p.category === product.category)
					.slice(0, 4);

				if (related.length === 0) {
					document.getElementById('related-products').innerHTML = `
						<div class="col-span-full text-center text-gray-500 py-8">
							<span class="material-symbols-rounded text-6xl text-gray-300 mb-2 block">inventory_2</span>
							No related products found.
						</div>
					`;
					return;
				}

				const relatedHtml = related.map(p => {
					const coverImage = Array.isArray(p.images) && p.images.length ? p.images[0] : 'assets/images/placeholder.jpg';
					const price = p.sellingPrice || p.price || 0;
					return `
						<div class="group relative bg-white rounded-lg border border-gray-200 shadow-sm hover:shadow-md hover:-translate-y-1 overflow-hidden flex flex-col">
							<button type="button" class="favorite-toggle absolute top-3 left-3 z-30 p-2 bg-white/90 border border-gray-200 rounded-full shadow-sm hover:bg-pink-50 transition-colors" data-product-favorite="${p.id}" aria-label="Save ${p.name}">
								<span class="material-symbols-rounded favorite-icon text-gray-500">favorite_border</span>
							</button>
							<a href="product.html?id=${p.id}" class="flex flex-col h-full">
								<div class="relative aspect-square bg-gray-50 overflow-hidden">
									<img src="${coverImage}" alt="${p.name}" class="w-full h-full object-contain p-6 group-hover:scale-110 transition-transform duration-300" />
									<span class="absolute top-3 right-3 px-2 py-1 ${getCategoryBadgeColor(p.category)} text-white text-xs font-bold rounded-full border border-white/40 shadow">
										${p.category}
									</span>
								</div>
								<div class="relative p-6 bg-white z-10 flex flex-col flex-1">
									<h3 class="font-bold text-gray-900 mb-2 group-hover:text-primary transition-colors line-clamp-2">${p.name}</h3>
									<p class="text-sm text-gray-600 mb-4 line-clamp-2 flex-1">${p.description}</p>
									<div class="flex items-center justify-between mt-auto">
										<span class="text-2xl font-bold text-primary">₹${price.toLocaleString('en-IN')}</span>
										<span class="material-symbols-rounded text-primary group-hover:translate-x-1 transition-transform">arrow_forward</span>
									</div>
								</div>
							</a>
						</div>
					`;
				}).join('');

				document.getElementById('related-products').innerHTML = relatedHtml;
				initializeFavoriteCardButtons(document.getElementById('related-products'));
			}

			// Category badge color
			function getCategoryBadgeColor(category) {
				const colors = {
					'RO Systems': 'bg-gradient-to-r from-blue-500 to-blue-600',
					'Filters': 'bg-gradient-to-r from-green-500 to-green-600',
					'Parts': 'bg-gradient-to-r from-purple-500 to-purple-600',
					'Accessories': 'bg-gradient-to-r from-orange-500 to-orange-600'
				};
				return colors[category] || 'bg-gradient-to-r from-gray-500 to-gray-600';
			}

			// Tab switching
			function setupTabs() {
				const tabButtons = document.querySelectorAll('.tab-button');
				const tabContents = document.querySelectorAll('.tab-content');

				tabButtons.forEach(button => {
					button.addEventListener('click', () => {
						const targetTab = button.dataset.tab;

						// Update buttons
						tabButtons.forEach(btn => {
							btn.classList.remove('active', 'border-primary', 'text-primary');
							btn.classList.add('border-transparent', 'text-gray-600');
						});
						button.classList.add('active', 'border-primary', 'text-primary');
						button.classList.remove('border-transparent', 'text-gray-600');

						// Update content
						tabContents.forEach(content => {
							content.classList.add('hidden');
						});
						document.getElementById(`tab-${targetTab}`).classList.remove('hidden');
					});
				});
			}

			// Initialize
			document.addEventListener('DOMContentLoaded', () => {
				loadProduct();
				setupTabs();
			});
		</script>

		<script type="module" src="/js/app.js"></script>
	</body>
</html>
