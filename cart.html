<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Shopping Cart - FinGaurd Water Purifiers</title>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<script>
			tailwind.config = {
				theme: {
					extend: {
						colors: {
							primary: '#2563eb',
							secondary: '#54e8e8',
							'primary-dark': '#1e40af'
						},
						fontFamily: {
							sans: ['Urbanist', 'system-ui', 'sans-serif'],
							display: ['Bebas Neue', 'Urbanist', 'sans-serif'],
							body: ['Urbanist', 'system-ui', 'sans-serif']
						}
					}
				}
			}
		</script>

		<!-- Custom CSS -->
		<link rel="stylesheet" href="/css/style.css" />
	</head>
	<body class="font-body antialiased text-gray-900 bg-gray-50">
		<header></header>

		<main class="pt-16 lg:pt-20 pb-16">
			<!-- Breadcrumb -->
			<section class="bg-white border-b border-gray-200">
				<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
					<nav class="flex items-center gap-2 text-sm text-gray-500">
						<a href="/index.html" class="hover:text-primary transition-colors">Home</a>
						<span class="material-symbols-rounded text-gray-400 text-sm">chevron_right</span>
						<span class="text-gray-700 font-medium">Shopping Cart</span>
					</nav>
				</div>
			</section>

			<!-- Cart Content -->
			<section class="py-8 lg:py-12">
				<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
					<!-- Page Header -->
					<div class="mb-8">
						<h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-2">Shopping Cart</h1>
						<p class="text-gray-600">Review your items and proceed to checkout</p>
					</div>

					<!-- Empty Cart State -->
					<div id="empty-cart" class="hidden text-center py-16">
						<span class="material-symbols-rounded text-9xl text-gray-300 mb-4 block">shopping_cart</span>
						<h2 class="text-2xl font-bold text-gray-900 mb-4">Your cart is empty</h2>
						<p class="text-gray-600 mb-8">Add some products to get started!</p>
						<a href="/products.html" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-xl hover:bg-primary-dark transition-colors">
							<span class="material-symbols-rounded">arrow_back</span>
							Continue Shopping
						</a>
					</div>

					<!-- Cart Items -->
					<div id="cart-items" class="grid lg:grid-cols-3 gap-8">
						<!-- Cart Items List -->
						<div class="lg:col-span-2 space-y-4">
							<div class="bg-white rounded-xl border border-gray-200 shadow-sm">
								<div class="p-4 border-b border-gray-200">
									<h2 class="font-bold text-lg flex items-center gap-2">
										<span class="material-symbols-rounded text-primary">inventory_2</span>
										Cart Items (<span id="total-items">0</span>)
									</h2>
								</div>
								<div id="cart-items-list" class="divide-y divide-gray-200">
									<!-- Dynamic cart items -->
								</div>
							</div>
						</div>

						<!-- Order Summary -->
						<div class="lg:col-span-1">
							<div class="bg-white rounded-xl border border-gray-200 shadow-sm sticky top-24">
								<div class="p-6 border-b border-gray-200">
									<h2 class="font-bold text-lg flex items-center gap-2">
										<span class="material-symbols-rounded text-primary">receipt</span>
										Order Summary
									</h2>
								</div>
								
								<div class="p-6 space-y-4">
									<!-- Subtotal -->
									<div class="flex justify-between text-gray-600">
										<span>Subtotal</span>
										<span>â‚¹<span id="subtotal">0</span></span>
									</div>
									
									<!-- Delivery -->
									<div class="flex justify-between text-gray-600">
										<span>Delivery</span>
										<span class="text-green-600 font-semibold">FREE</span>
									</div>
									
									<!-- Installation -->
									<div class="flex justify-between text-gray-600">
										<span>Installation</span>
										<span class="text-green-600 font-semibold">FREE</span>
									</div>
									
									<div class="border-t border-gray-200 pt-4">
										<div class="flex justify-between text-lg font-bold text-gray-900">
											<span>Total</span>
											<span>â‚¹<span id="total">0</span></span>
										</div>
										<p class="text-xs text-gray-500 mt-1">Inclusive of all taxes</p>
									</div>

									<!-- Checkout Button -->
									<button 
										id="checkout-btn"
										class="w-full flex items-center justify-center gap-2 px-6 py-4 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white font-bold rounded-xl transition-all hover:shadow-lg group"
									>
										<span class="material-symbols-rounded">check_circle</span>
										<span>Proceed to Checkout</span>
										<span class="material-symbols-rounded group-hover:translate-x-1 transition-transform">arrow_forward</span>
									</button>

									<!-- Continue Shopping -->
									<a 
										href="/products.html"
										class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-white border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:border-primary hover:text-primary transition-colors"
									>
										<span class="material-symbols-rounded">arrow_back</span>
										<span>Continue Shopping</span>
									</a>
								</div>

								<!-- Trust Badges -->
								<div class="p-6 bg-gray-50 border-t border-gray-200 rounded-b-xl">
									<div class="space-y-3">
										<div class="flex items-center gap-3 text-sm text-gray-700">
											<span class="material-symbols-rounded text-green-600">verified</span>
											<span>1 Year Warranty</span>
										</div>
										<div class="flex items-center gap-3 text-sm text-gray-700">
											<span class="material-symbols-rounded text-green-600">local_shipping</span>
											<span>Free Delivery & Installation</span>
										</div>
										<div class="flex items-center gap-3 text-sm text-gray-700">
											<span class="material-symbols-rounded text-green-600">support_agent</span>
											<span>24/7 Customer Support</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Checkout Modal -->
			<div id="checkout-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
				<div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
					<!-- Modal Header -->
					<div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-2xl">
						<div class="flex items-center justify-between">
							<h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
								<span class="material-symbols-rounded text-primary">shopping_bag</span>
								Complete Your Order
							</h2>
							<button id="close-modal" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
								<span class="material-symbols-rounded text-gray-600">close</span>
							</button>
						</div>
					</div>

					<!-- Modal Content -->
					<div class="p-6">
						<form id="checkout-form" class="space-y-6">
							<!-- Contact Information -->
							<div>
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">person</span>
									Contact Information
								</h3>
								<div class="grid md:grid-cols-2 gap-4">
									<div>
										<label for="checkout-name" class="block text-sm font-semibold text-gray-700 mb-2">
											Full Name *
										</label>
										<input 
											type="text" 
											id="checkout-name" 
											name="name" 
											required
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
											placeholder="Enter your name"
										/>
									</div>
									<div>
										<label for="checkout-phone" class="block text-sm font-semibold text-gray-700 mb-2">
											Phone Number *
										</label>
										<input 
											type="tel" 
											id="checkout-phone" 
											name="phone" 
											required
											pattern="[0-9]{10}"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
											placeholder="10-digit number"
										/>
									</div>
								</div>
							</div>

							<!-- Delivery Address -->
							<div>
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">location_on</span>
									Delivery Address
								</h3>
								<div class="space-y-4">
									<div>
										<label for="checkout-address" class="block text-sm font-semibold text-gray-700 mb-2">
											Complete Address *
										</label>
										<textarea 
											id="checkout-address" 
											name="address" 
											required
											rows="3"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white resize-none"
											placeholder="House/Flat No, Street, Area, Landmark"
										></textarea>
									</div>
									<div class="grid md:grid-cols-3 gap-4">
										<div>
											<label for="checkout-city" class="block text-sm font-semibold text-gray-700 mb-2">
												City *
											</label>
											<input 
												type="text" 
												id="checkout-city" 
												name="city" 
												required
												class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
												placeholder="City"
											/>
										</div>
										<div>
											<label for="checkout-state" class="block text-sm font-semibold text-gray-700 mb-2">
												State *
											</label>
											<input 
												type="text" 
												id="checkout-state" 
												name="state" 
												required
												class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
												placeholder="State"
											/>
										</div>
										<div>
											<label for="checkout-pincode" class="block text-sm font-semibold text-gray-700 mb-2">
												Pincode *
											</label>
											<input 
												type="text" 
												id="checkout-pincode" 
												name="pincode" 
												required
												pattern="[0-9]{6}"
												class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
												placeholder="6-digit"
											/>
										</div>
									</div>
								</div>
							</div>

							<!-- Additional Information -->
							<div>
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">info</span>
									Additional Information
								</h3>
								<div class="grid md:grid-cols-2 gap-4">
									<div>
										<label for="checkout-family" class="block text-sm font-semibold text-gray-700 mb-2">
											Family Size
										</label>
										<select 
											id="checkout-family" 
											name="family"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
										>
											<option value="">Select family size</option>
											<option value="1-2">1-2 members</option>
											<option value="3-4">3-4 members</option>
											<option value="5-6">5-6 members</option>
											<option value="7+">7+ members</option>
										</select>
									</div>
									<div>
										<label for="checkout-water" class="block text-sm font-semibold text-gray-700 mb-2">
											Water Source
										</label>
										<select 
											id="checkout-water" 
											name="water"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
										>
											<option value="">Select water source</option>
											<option value="Municipal">Municipal Supply</option>
											<option value="Borewell">Borewell</option>
											<option value="Tanker">Tanker Water</option>
											<option value="Other">Other</option>
										</select>
									</div>
								</div>
								<div class="mt-4">
									<label for="checkout-notes" class="block text-sm font-semibold text-gray-700 mb-2">
										Order Notes (Optional)
									</label>
									<textarea 
										id="checkout-notes" 
										name="notes"
										rows="2"
										class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white resize-none"
										placeholder="Any special instructions or preferences?"
									></textarea>
								</div>
							</div>

							<!-- Order Summary in Modal -->
							<div class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6">
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">receipt_long</span>
									Order Summary
								</h3>
								<div id="modal-order-items" class="space-y-2 mb-4 max-h-40 overflow-y-auto">
									<!-- Dynamic order items -->
								</div>
								<div class="pt-4 border-t-2 border-blue-200">
									<div class="flex justify-between text-2xl font-bold text-primary">
										<span>Total Amount:</span>
										<span>â‚¹<span id="modal-total">0</span></span>
									</div>
									<p class="text-xs text-gray-600 mt-1">Free delivery â€¢ Free installation â€¢ 1 Year warranty</p>
								</div>
							</div>

							<!-- Submit Button -->
							<button 
								type="submit"
								class="w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white font-bold text-lg rounded-xl hover:shadow-lg transition-all group"
							>
								<span class="material-symbols-rounded text-2xl">send</span>
								<span>Place Order via WhatsApp</span>
								<span class="material-symbols-rounded group-hover:translate-x-1 transition-transform">arrow_forward</span>
							</button>

							<div class="bg-green-50 border border-green-200 rounded-lg p-4">
								<p class="text-sm text-gray-700 flex items-start gap-2">
									<span class="material-symbols-rounded text-green-600 text-base mt-0.5">info</span>
									<span>Your order will be sent via WhatsApp for confirmation. Our team will contact you within 2 hours to finalize the order.</span>
								</p>
							</div>
						</form>
					</div>
				</div>
			</div>
		</main>

		<footer></footer>

		<!-- Cart JavaScript -->
		<script src="/js/cart.js"></script>
		<script>
			(() => {
				const CartAPI = window.Cart;
				const WhatsAppAPI = window.WhatsApp;
				const currencySymbol = typeof window.currency === 'string' ? window.currency : 'â‚¹';
				const FALLBACK_IMAGE = 'assets/images/placeholder.jpg';
				let renderedCartItems = [];
				let productCache = null;

				const notify = (type, message, duration = 6000) => {
					const alertApi = window.Alert;
					if (alertApi && typeof alertApi[type] === 'function') {
						alertApi[type](message, duration);
						return;
					}
					if (alertApi && typeof alertApi.show === 'function') {
						alertApi.show(message, type, duration);
						return;
					}
					if (typeof window.showAlert === 'function') {
						window.showAlert(message, type, duration);
						return;
					}
					window.alert(message);
				};

				if (!CartAPI) {
					console.error('Cart module failed to load. Cart page scripts aborted.');
					return;
				}

				const ProductDB = {
					async getAllProducts() {
						if (Array.isArray(productCache)) {
							return productCache;
						}

						try {
							const response = await fetch('/data/products.json', { cache: 'no-cache' });
							if (!response.ok) {
								throw new Error(`Failed to fetch products: ${response.status}`);
							}
							productCache = await response.json();
						} catch (error) {
							console.error('Failed to fetch products:', error);
							productCache = [];
						}

						return productCache;
					}
				};

				const formatCurrency = (value) => (Number(value) || 0).toLocaleString('en-IN');

				const getPrimaryImage = (product) => {
					if (product && Array.isArray(product.images) && product.images.length > 0) {
						return product.images[0];
					}
					return FALLBACK_IMAGE;
				};

				async function loadCart() {
					const storedCart = CartAPI.getCart();
					const cart = Array.isArray(storedCart) ? storedCart : [];

					if (!cart.length) {
						renderedCartItems = [];
						toggleCartVisibility(false);
						updateCartSummary([]);
						return;
					}

					const allProducts = await ProductDB.getAllProducts();

					renderedCartItems = cart
						.map((rawItem) => {
							if (!rawItem) return null;

							const quantity = Math.max(0, Number(rawItem.quantity) || 0);
							if (quantity === 0) return null;

							const rawId = rawItem.id;
							const matchedProduct = allProducts.find((product) => String(product.id) === String(rawId));

							if (matchedProduct) {
								return {
									id: rawId,
									quantity,
									name: matchedProduct.name,
									sku: matchedProduct.sku,
									price: Number(matchedProduct.price) || 0,
									image: getPrimaryImage(matchedProduct)
								};
							}

							if (rawItem.name || rawItem.price) {
								return {
									id: rawId,
									quantity,
									name: rawItem.name || `Product ${rawId}`,
									sku: rawItem.sku || 'N/A',
									price: Number(rawItem.price) || 0,
									image: rawItem.image || FALLBACK_IMAGE
								};
							}

							return null;
						})
						.filter(Boolean);

					toggleCartVisibility(renderedCartItems.length > 0);
					displayCartItems(renderedCartItems);
					updateCartSummary(renderedCartItems);
				}

				function toggleCartVisibility(hasItems) {
					const emptyState = document.getElementById('empty-cart');
					const cartSection = document.getElementById('cart-items');
					const list = document.getElementById('cart-items-list');

					if (!emptyState || !cartSection || !list) return;

					if (hasItems) {
						emptyState.classList.add('hidden');
						cartSection.classList.remove('hidden');
					} else {
						emptyState.classList.remove('hidden');
						cartSection.classList.add('hidden');
						list.innerHTML = '';
					}
				}

				function displayCartItems(items) {
					const container = document.getElementById('cart-items-list');
					if (!container) return;

					container.innerHTML = items
						.map((item) => {
							const itemIdAttr = String(item.id).replace(/"/g, '&quot;');

							return `
								<div class="p-6 flex flex-col sm:flex-row gap-4 hover:bg-gray-50 transition-colors" data-cart-row="${itemIdAttr}">
									<div class="flex-shrink-0">
										<img src="${item.image || FALLBACK_IMAGE}" alt="${item.name}" class="w-24 h-24 object-contain rounded-lg border border-gray-200" />
									</div>
									<div class="flex-1 min-w-0">
										<h3 class="font-bold text-gray-900 mb-1 line-clamp-2">${item.name}</h3>
										<p class="text-sm text-gray-500 mb-2">SKU: ${item.sku}</p>
										<div class="flex items-center gap-4">
											<span class="text-xl font-bold text-primary">${currencySymbol}${formatCurrency(item.price)}</span>
											<span class="text-sm text-gray-500">per unit</span>
										</div>
									</div>
									<div class="flex sm:flex-col items-center sm:items-end justify-between sm:justify-start gap-4">
										<div class="flex items-center gap-3 bg-gray-100 rounded-lg p-1">
											<button type="button" class="w-8 h-8 flex items-center justify-center bg-white rounded hover:bg-primary hover:text-white transition-colors" data-cart-action="decrement" data-cart-id="${itemIdAttr}">
												<span class="material-symbols-rounded text-lg">remove</span>
											</button>
											<span class="w-8 text-center font-bold">${item.quantity}</span>
											<button type="button" class="w-8 h-8 flex items-center justify-center bg-white rounded hover:bg-primary hover:text-white transition-colors" data-cart-action="increment" data-cart-id="${itemIdAttr}">
												<span class="material-symbols-rounded text-lg">add</span>
											</button>
										</div>
										<button type="button" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Remove item" data-cart-action="remove" data-cart-id="${itemIdAttr}">
											<span class="material-symbols-rounded">delete</span>
										</button>
									</div>
								</div>
							`;
						})
						.join('');

					const totalItems = items.reduce((sum, item) => sum + Number(item.quantity || 0), 0);
					const totalItemsEl = document.getElementById('total-items');
					if (totalItemsEl) {
						totalItemsEl.textContent = totalItems;
					}
				}

				function updateCartSummary(items) {
					const subtotal = items.reduce((sum, item) => {
						const price = Number(item.price) || 0;
						const qty = Number(item.quantity) || 0;
						return sum + price * qty;
					}, 0);

					const subtotalEl = document.getElementById('subtotal');
					const totalEl = document.getElementById('total');

					if (subtotalEl) subtotalEl.textContent = formatCurrency(subtotal);
					if (totalEl) totalEl.textContent = formatCurrency(subtotal);
				}

				function handleCartListClick(event) {
					const actionButton = event.target.closest('[data-cart-action]');
					if (!actionButton) return;

					event.preventDefault();

					const action = actionButton.getAttribute('data-cart-action');
					const cartId = actionButton.getAttribute('data-cart-id');
					if (!action || !cartId) return;

					const item = renderedCartItems.find((entry) => String(entry.id) === cartId);
					if (!item) return;

					if (action === 'increment') {
						CartAPI.updateItemQuantity(item.id, Number(item.quantity) + 1);
					} else if (action === 'decrement') {
						CartAPI.updateItemQuantity(item.id, Number(item.quantity) - 1);
					} else if (action === 'remove') {
						CartAPI.removeItem(item.id);
					}

					loadCart();
				}

				async function openCheckoutModal() {
					if (!renderedCartItems.length) {
						notify('info', 'Your cart is empty! Please add some products before checking out.');
						return;
					}

					const modalItems = document.getElementById('modal-order-items');
					if (modalItems) {
						modalItems.innerHTML = renderedCartItems
							.map((item) => `
								<div class="flex justify-between text-sm">
									<span class="text-gray-700">${item.name} Ã— ${item.quantity}</span>
									<span class="font-semibold text-gray-900">${currencySymbol}${formatCurrency(item.price * item.quantity)}</span>
								</div>
							`)
							.join('');
					}

					const total = renderedCartItems.reduce((sum, item) => sum + (Number(item.price) || 0) * (Number(item.quantity) || 0), 0);
					const modalTotal = document.getElementById('modal-total');
					if (modalTotal) {
						modalTotal.textContent = formatCurrency(total);
					}

					const checkoutModal = document.getElementById('checkout-modal');
					if (checkoutModal) {
						checkoutModal.classList.remove('hidden');
					}
					document.body.style.overflow = 'hidden';
				}

				function closeCheckoutModal() {
					const checkoutModal = document.getElementById('checkout-modal');
					if (checkoutModal) {
						checkoutModal.classList.add('hidden');
					}
					document.body.style.overflow = '';
				}

				async function handleCheckout(event) {
					event.preventDefault();

					if (!renderedCartItems.length) {
						notify('info', 'Your cart is empty! Please add some products before checking out.');
						return;
					}

					const formData = new FormData(event.target);
					let message = `ðŸ›’ *NEW ORDER FROM FINGAURD WEBSITE*\n\n`;
					message += `ðŸ‘¤ *Customer Details:*\n`;
					message += `Name: ${formData.get('name')}\n`;
					message += `Phone: ${formData.get('phone')}\n\n`;
					message += `ðŸ“ *Delivery Address:*\n`;
					message += `${formData.get('address')}\n`;
					message += `${formData.get('city')}, ${formData.get('state')} - ${formData.get('pincode')}\n\n`;

					const family = formData.get('family');
					const water = formData.get('water');
					if (family || water) {
						message += `â„¹ï¸ *Additional Info:*\n`;
						if (family) message += `Family Size: ${family}\n`;
						if (water) message += `Water Source: ${water}\n`;
						message += `\n`;
					}

					message += `ðŸ›ï¸ *Order Items:*\n`;
					renderedCartItems.forEach((item, index) => {
						const lineTotal = (Number(item.price) || 0) * (Number(item.quantity) || 0);
						message += `${index + 1}. ${item.name}\n`;
						message += `   SKU: ${item.sku}\n`;
						message += `   Qty: ${item.quantity} Ã— ${currencySymbol}${formatCurrency(item.price)} = ${currencySymbol}${formatCurrency(lineTotal)}\n\n`;
					});

					const total = renderedCartItems.reduce((sum, item) => sum + (Number(item.price) || 0) * (Number(item.quantity) || 0), 0);
					message += `ðŸ’° *Total Amount: ${currencySymbol}${formatCurrency(total)}*\n`;
					message += `âœ… Free Delivery â€¢ Free Installation â€¢ 1 Year Warranty\n\n`;

					const notes = formData.get('notes');
					if (notes) {
						message += `ðŸ“ *Order Notes:*\n${notes}\n\n`;
					}

					message += `---\n`;
					message += `Order placed from: ${window.location.origin}\n`;
					message += `Date: ${new Date().toLocaleString('en-IN')}`;

					if (WhatsAppAPI && typeof WhatsAppAPI.send === 'function') {
						WhatsAppAPI.send(message);
					} else {
						console.error('WhatsApp module is unavailable. Unable to send checkout message.');
					}

					notify('success', 'ðŸŽ‰ Your order has been sent via WhatsApp! Our team will contact you shortly to confirm your order.');

					CartAPI.clearCart();
					closeCheckoutModal();
					loadCart();
				}

				document.addEventListener('DOMContentLoaded', () => {
					loadCart();

					const cartItemsList = document.getElementById('cart-items-list');
					if (cartItemsList) {
						cartItemsList.addEventListener('click', handleCartListClick);
					}

					const checkoutBtn = document.getElementById('checkout-btn');
					if (checkoutBtn) {
						checkoutBtn.addEventListener('click', openCheckoutModal);
					}

					const closeModalBtn = document.getElementById('close-modal');
					if (closeModalBtn) {
						closeModalBtn.addEventListener('click', closeCheckoutModal);
					}

					const checkoutForm = document.getElementById('checkout-form');
					if (checkoutForm) {
						checkoutForm.addEventListener('submit', handleCheckout);
					}

					const checkoutModal = document.getElementById('checkout-modal');
					if (checkoutModal) {
						checkoutModal.addEventListener('click', (event) => {
							if (event.target === checkoutModal) {
								closeCheckoutModal();
							}
						});
					}
				});
			})();
		</script>

		<script type="module" src="/js/app.js"></script>
	</body>
</html>
