<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Shopping Cart - FinGaurd Water Purifiers</title>

		<!-- Tailwind CSS -->
		<script src="https://cdn.tailwindcss.com"></script>
		<script>
			tailwind.config = {
				theme: {
					extend: {
						colors: {
							primary: '#2563eb',
							secondary: '#54e8e8',
							'primary-dark': '#1e40af'
						},
						fontFamily: {
							sans: ['Urbanist', 'system-ui', 'sans-serif'],
							display: ['Bebas Neue', 'Urbanist', 'sans-serif'],
							body: ['Urbanist', 'system-ui', 'sans-serif']
						}
					}
				}
			}
		</script>

		<!-- Custom CSS -->
		<link rel="stylesheet" href="/css/style.css" />
	</head>
	<body class="font-body antialiased text-gray-900 bg-gray-50">
		<header></header>

		<main class="pt-16 lg:pt-20">
			<!-- Breadcrumb -->
			<section class="bg-white border-b border-gray-200">
				<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4">
					<nav class="flex items-center gap-2 text-sm text-gray-500">
						<a href="/index.html" class="hover:text-primary transition-colors">Home</a>
						<span class="material-symbols-rounded text-gray-400 text-sm">chevron_right</span>
						<span class="text-gray-700 font-medium">Shopping Cart</span>
					</nav>
				</div>
			</section>

			<!-- Cart Content -->
			<section class="py-8 lg:py-12">
				<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
					<!-- Page Header -->
					<div class="mb-8">
						<h1 class="text-3xl lg:text-4xl font-bold text-gray-900 mb-2">Shopping Cart</h1>
						<p class="text-gray-600">Review your items and proceed to checkout</p>
					</div>

					<!-- Empty Cart State -->
					<div id="empty-cart" class="hidden text-center py-16">
						<span class="material-symbols-rounded text-9xl text-gray-300 mb-4 block">shopping_cart</span>
						<h2 class="text-2xl font-bold text-gray-900 mb-4">Your cart is empty</h2>
						<p class="text-gray-600 mb-8">Add some products to get started!</p>
						<a href="/products.html" class="inline-flex items-center gap-2 px-6 py-3 bg-primary text-white rounded-xl hover:bg-primary-dark transition-colors">
							<span class="material-symbols-rounded">arrow_back</span>
							Continue Shopping
						</a>
					</div>

					<!-- Cart Items -->
					<div id="cart-items" class="grid lg:grid-cols-3 gap-6 lg:gap-8">
						<!-- Cart Items List -->
						<div class="lg:col-span-2 space-y-4 min-w-0">
							<div class="bg-white rounded-xl border border-gray-200 shadow-sm overflow-hidden">
								<div class="p-4 sm:p-6 border-b border-gray-200">
									<h2 class="font-bold text-base sm:text-lg flex items-center gap-2">
										<span class="material-symbols-rounded text-primary">inventory_2</span>
										Cart Items (<span id="total-items">0</span>)
									</h2>
								</div>
								<div id="cart-items-list" class="divide-y divide-gray-200">
									<!-- Dynamic cart items -->
								</div>
							</div>
						</div>

						<!-- Order Summary -->
						<div class="lg:col-span-1 min-w-0">
							<div class="bg-white rounded-xl border border-gray-200 shadow-sm sticky top-24 overflow-hidden">
								<div class="p-4 sm:p-6 border-b border-gray-200">
									<h2 class="font-bold text-base sm:text-lg flex items-center gap-2">
										<span class="material-symbols-rounded text-primary">receipt</span>
										Order Summary
									</h2>
								</div>
								
								<div class="p-4 sm:p-6 space-y-4">
									<!-- Subtotal -->
									<div class="flex justify-between text-gray-600">
										<span>Subtotal</span>
										<span>â‚¹<span id="subtotal">0</span></span>
									</div>
									
									<!-- Delivery -->
									<div class="flex justify-between text-gray-600">
										<span class="flex items-center gap-1">
											Delivery
											<span id="delivery-info" class="material-symbols-rounded text-sm text-gray-400 cursor-help" title="Standard delivery â‚¹299">info</span>
										</span>
										<span id="delivery-charge-container">
											<span id="delivery-charge-original" class="text-gray-400 line-through text-sm mr-1"></span>
											<span id="delivery-charge" class="text-gray-900 font-semibold">â‚¹299</span>
										</span>
									</div>

									<!-- Delivery savings badge (shown when discounted) -->
									<div id="delivery-savings" class="hidden -mt-2 mb-2">
										<div class="flex items-center gap-1.5 text-xs text-green-700 bg-green-50 px-3 py-1.5 rounded-lg border border-green-200">
											<span class="material-symbols-rounded text-sm">local_shipping</span>
											<span id="delivery-savings-text">Save â‚¹100 on delivery!</span>
										</div>
									</div>
									
									<!-- Installation -->
									<div class="flex justify-between text-gray-600">
										<span>Installation</span>
										<span class="text-green-600 font-semibold">FREE</span>
									</div>
									
									<div class="border-t border-gray-200 pt-4">
										<div class="flex justify-between text-lg font-bold text-gray-900">
											<span>Total</span>
											<span>â‚¹<span id="total">0</span></span>
										</div>
										<p class="text-xs text-gray-500 mt-1">Inclusive of all taxes</p>
									</div>

									<!-- Checkout Button -->
									<button 
										id="checkout-btn"
										class="w-full flex items-center justify-center gap-2 px-6 py-4 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white font-bold rounded-xl transition-all hover:shadow-lg group"
									>
										<span class="material-symbols-rounded">check_circle</span>
										<span>Proceed to Checkout</span>
										<span class="material-symbols-rounded group-hover:translate-x-1 transition-transform">arrow_forward</span>
									</button>

									<!-- Continue Shopping -->
									<a 
										href="/products.html"
										class="w-full flex items-center justify-center gap-2 px-6 py-3 bg-white border-2 border-gray-300 text-gray-700 font-semibold rounded-xl hover:border-primary hover:text-primary transition-colors"
									>
										<span class="material-symbols-rounded">arrow_back</span>
										<span>Continue Shopping</span>
									</a>
								</div>

								<!-- Prepaid Discount Promo - Hidden by default, shown when cart has items -->
								<div id="prepaid-promo-card" class="hidden p-4 bg-gradient-to-r from-green-50 to-emerald-50 border-t border-green-200">
									<div class="space-y-3">
										<!-- Header -->
										<div class="flex items-start gap-2">
											<svg class="w-5 h-5 text-green-600 flex-shrink-0 mt-0.5" fill="currentColor" viewBox="0 0 20 20">
												<path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
												<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
											</svg>
											<div class="flex-1">
												<h3 class="font-bold text-sm text-gray-900">Save More on Your Order!</h3>
												<p class="text-xs text-gray-600 mt-0.5">Delivery discounts + Prepaid discounts when you order via WhatsApp</p>
											</div>
										</div>

										<!-- Discount Details -->
										<div class="space-y-2">
											<!-- Delivery Discounts (First) -->
											<div>
												<div class="flex items-center gap-1.5 mb-2">
													<svg class="w-4 h-4 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
														<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"/>
													</svg>
													<span class="text-xs font-bold text-gray-900">ðŸšš Delivery Savings:</span>
												</div>
												<div class="space-y-1.5">
													<div class="flex items-center gap-2 text-xs bg-blue-50 rounded-lg p-2 border border-blue-200">
														<svg class="w-4 h-4 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 8h14M5 8a2 2 0 110-4h14a2 2 0 110 4M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8m-9 4h4"/>
														</svg>
														<span class="text-gray-700">Orders â‰¥ â‚¹1,999: <strong class="text-blue-700">â‚¹199 delivery</strong> (save â‚¹100)</span>
													</div>
													<div class="flex items-center gap-2 text-xs bg-blue-50 rounded-lg p-2 border border-blue-200">
														<svg class="w-4 h-4 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
														</svg>
														<span class="text-gray-700">Orders â‰¥ â‚¹4,999: <strong class="text-blue-700">FREE delivery</strong> (save â‚¹299)</span>
													</div>
												</div>
											</div>
											
											<!-- Prepaid Discounts (Second) -->
											<div class="pt-3 border-t border-green-200">
												<div class="flex items-center gap-1.5 mb-2">
													<svg class="w-4 h-4 text-green-600" fill="currentColor" viewBox="0 0 20 20">
														<path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
														<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
													</svg>
													<span class="text-xs font-bold text-gray-900">ðŸ’° Prepaid Discounts:</span>
												</div>
												<div class="space-y-1.5">
													<div class="flex items-center gap-2 text-xs bg-white rounded-lg p-2 border border-green-200">
														<svg class="w-4 h-4 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
														</svg>
														<span class="text-gray-700"><strong class="text-green-700">5% off</strong> (up to â‚¹100) for orders â‰¤ â‚¹5,000</span>
													</div>
													<div class="flex items-center gap-2 text-xs bg-white rounded-lg p-2 border border-green-200">
														<svg class="w-4 h-4 text-green-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
															<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
														</svg>
														<span class="text-gray-700"><strong class="text-green-700">Flat â‚¹250 off</strong> for orders &gt; â‚¹5,000</span>
													</div>
												</div>
											</div>
										</div>

										<!-- Ordering Flow -->
										<div class="bg-white rounded-lg p-2.5 border border-green-200">
											<div class="flex items-center gap-1.5 text-xs text-gray-700">
												<svg class="w-4 h-4 text-primary flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z"/>
												</svg>
												<span class="font-medium">Add to cart</span>
												<span class="text-gray-400">â€¢</span>
												<svg class="w-4 h-4 text-green-600 flex-shrink-0" fill="currentColor" viewBox="0 0 24 24">
													<path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413z"/>
												</svg>
												<span class="font-medium">WhatsApp</span>
												<span class="text-gray-400">â€¢</span>
												<svg class="w-4 h-4 text-blue-600 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
													<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
												</svg>
												<span class="font-medium">Confirm availability</span>
												<span class="text-gray-400">â€¢</span>
												<svg class="w-4 h-4 text-green-600 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
													<path d="M8.433 7.418c.155-.103.346-.196.567-.267v1.698a2.305 2.305 0 01-.567-.267C8.07 8.34 8 8.114 8 8c0-.114.07-.34.433-.582zM11 12.849v-1.698c.22.071.412.164.567.267.364.243.433.468.433.582 0 .114-.07.34-.433.582a2.305 2.305 0 01-.567.267z"/>
													<path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-13a1 1 0 10-2 0v.092a4.535 4.535 0 00-1.676.662C6.602 6.234 6 7.009 6 8c0 .99.602 1.765 1.324 2.246.48.32 1.054.545 1.676.662v1.941c-.391-.127-.68-.317-.843-.504a1 1 0 10-1.51 1.31c.562.649 1.413 1.076 2.353 1.253V15a1 1 0 102 0v-.092a4.535 4.535 0 001.676-.662C13.398 13.766 14 12.991 14 12c0-.99-.602-1.765-1.324-2.246A4.535 4.535 0 0011 9.092V7.151c.391.127.68.317.843.504a1 1 0 101.511-1.31c-.563-.649-1.413-1.076-2.354-1.253V5z" clip-rule="evenodd"/>
												</svg>
												<span class="font-medium">Pay discounted price</span>
											</div>
										</div>

										<!-- Bottom Notice -->
										<div class="flex items-start gap-1.5 text-xs text-gray-600">
											<svg class="w-4 h-4 text-blue-500 flex-shrink-0 mt-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"/>
											</svg>
											<span>After adding items to cart, you'll be redirected to WhatsApp where we'll confirm product availability and apply your prepaid discount before payment.</span>
										</div>
									</div>
								</div>

								<!-- Trust Badges -->
								<div class="p-6 bg-gray-50 border-t border-gray-200 rounded-b-xl">
									<div class="space-y-3">
										<div class="flex items-center gap-3 text-sm text-gray-700">
											<span class="material-symbols-rounded text-green-600">verified</span>
											<span>1 Year Warranty</span>
										</div>
										<div class="flex items-center gap-3 text-sm text-gray-700">
											<span class="material-symbols-rounded text-green-600">local_shipping</span>
											<span>Free Delivery & Installation</span>
										</div>
										<div class="flex items-center gap-3 text-sm text-gray-700">
											<span class="material-symbols-rounded text-green-600">support_agent</span>
											<span>Customer Support (11 AM-5 PM Mon-Sat)</span>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</section>

			<!-- Checkout Modal -->
			<div id="checkout-modal" class="hidden fixed inset-0 bg-black/50 backdrop-blur-sm z-50 flex items-center justify-center p-4">
				<div class="bg-white rounded-2xl shadow-2xl max-w-2xl w-full max-h-[90vh] overflow-y-auto">
					<!-- Modal Header -->
					<div class="sticky top-0 bg-white border-b border-gray-200 p-6 rounded-t-2xl">
						<div class="flex items-center justify-between">
							<h2 class="text-2xl font-bold text-gray-900 flex items-center gap-2">
								<span class="material-symbols-rounded text-primary">shopping_bag</span>
								Complete Your Order
							</h2>
							<button id="close-modal" class="p-2 hover:bg-gray-100 rounded-xl transition-colors">
								<span class="material-symbols-rounded text-gray-600">close</span>
							</button>
						</div>
					</div>

					<!-- Modal Content -->
					<div class="p-6">
						<form id="checkout-form" class="space-y-6">
							<!-- Contact Information -->
							<div>
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">person</span>
									Contact Information
								</h3>
								<div class="grid md:grid-cols-2 gap-4">
									<div>
										<label for="checkout-name" class="block text-sm font-semibold text-gray-700 mb-2">
											Full Name *
										</label>
										<input 
											type="text" 
											id="checkout-name" 
											name="name" 
											required
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
											placeholder="Enter your name"
										/>
									</div>
									<div>
										<label for="checkout-phone" class="block text-sm font-semibold text-gray-700 mb-2">
											Phone Number *
										</label>
										<input 
											type="tel" 
											id="checkout-phone" 
											name="phone" 
											required
											pattern="[0-9]{10}"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
											placeholder="10-digit number"
										/>
									</div>
								</div>
							</div>

							<!-- Delivery Address -->
							<div>
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">location_on</span>
									Delivery Address
								</h3>
								<div class="space-y-4">
									<div>
										<label for="checkout-address" class="block text-sm font-semibold text-gray-700 mb-2">
											Complete Address *
										</label>
										<textarea 
											id="checkout-address" 
											name="address" 
											required
											rows="3"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white resize-none"
											placeholder="House/Flat No, Street, Area, Landmark"
										></textarea>
									</div>
									<div class="grid md:grid-cols-3 gap-4">
										<div>
											<label for="checkout-city" class="block text-sm font-semibold text-gray-700 mb-2">
												City *
											</label>
											<input 
												type="text" 
												id="checkout-city" 
												name="city" 
												required
												class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
												placeholder="City"
											/>
										</div>
										<div>
											<label for="checkout-state" class="block text-sm font-semibold text-gray-700 mb-2">
												State *
											</label>
											<input 
												type="text" 
												id="checkout-state" 
												name="state" 
												required
												class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
												placeholder="State"
											/>
										</div>
										<div>
											<label for="checkout-pincode" class="block text-sm font-semibold text-gray-700 mb-2">
												Pincode *
											</label>
											<input 
												type="text" 
												id="checkout-pincode" 
												name="pincode" 
												required
												pattern="[0-9]{6}"
												class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
												placeholder="6-digit"
											/>
										</div>
									</div>
								</div>
							</div>

							<!-- Additional Information -->
							<div>
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">info</span>
									Additional Information
								</h3>
								<div class="grid md:grid-cols-2 gap-4">
									<div>
										<label for="checkout-family" class="block text-sm font-semibold text-gray-700 mb-2">
											Family Size
										</label>
										<select 
											id="checkout-family" 
											name="family"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
										>
											<option value="">Select family size</option>
											<option value="1-2">1-2 members</option>
											<option value="3-4">3-4 members</option>
											<option value="5-6">5-6 members</option>
											<option value="7+">7+ members</option>
										</select>
									</div>
									<div>
										<label for="checkout-water" class="block text-sm font-semibold text-gray-700 mb-2">
											Water Source
										</label>
										<select 
											id="checkout-water" 
											name="water"
											class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white"
										>
											<option value="">Select water source</option>
											<option value="Municipal">Municipal Supply</option>
											<option value="Borewell">Borewell</option>
											<option value="Tanker">Tanker Water</option>
											<option value="Other">Other</option>
										</select>
									</div>
								</div>
								<div class="mt-4">
									<label for="checkout-notes" class="block text-sm font-semibold text-gray-700 mb-2">
										Order Notes (Optional)
									</label>
									<textarea 
										id="checkout-notes" 
										name="notes"
										rows="2"
										class="w-full px-4 py-3 bg-gray-50 border-2 border-gray-200 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary focus:bg-white resize-none"
										placeholder="Any special instructions or preferences?"
									></textarea>
								</div>
							</div>

							<!-- Order Summary in Modal -->
							<div class="bg-gradient-to-br from-blue-50 to-indigo-50 border-2 border-blue-200 rounded-xl p-6">
								<h3 class="font-bold text-lg mb-4 flex items-center gap-2">
									<span class="material-symbols-rounded text-primary">receipt_long</span>
									Order Summary
								</h3>
								<div id="modal-order-items" class="space-y-2 mb-4 max-h-40 overflow-y-auto">
									<!-- Dynamic order items -->
								</div>
								<div class="pt-4 border-t-2 border-blue-200">
									<div class="flex justify-between text-2xl font-bold text-primary">
										<span>Total Amount:</span>
										<span>â‚¹<span id="modal-total">0</span></span>
									</div>
									<p class="text-xs text-gray-600 mt-1">Free delivery â€¢ Free installation â€¢ 1 Year warranty</p>
								</div>
							</div>

							<!-- Submit Button -->
							<button 
								type="submit"
								class="w-full flex items-center justify-center gap-3 px-6 py-4 bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600 text-white font-bold text-lg rounded-xl hover:shadow-lg transition-all group"
							>
								<span class="material-symbols-rounded text-2xl">send</span>
								<span>Place Order via WhatsApp</span>
								<span class="material-symbols-rounded group-hover:translate-x-1 transition-transform">arrow_forward</span>
							</button>

							<div class="bg-green-50 border border-green-200 rounded-lg p-4">
								<p class="text-sm text-gray-700 flex items-start gap-2">
									<span class="material-symbols-rounded text-green-600 text-base mt-0.5">info</span>
									<span>Your order will be sent via WhatsApp for confirmation. Our team will contact you within 2 hours to finalize the order.</span>
								</p>
							</div>
						</form>
					</div>
				</div>
			</div>
		</main>

		<footer></footer>

		<!-- Cart JavaScript -->
		<script src="/js/cart.js"></script>
		<script>
			(() => {
				const CartAPI = window.Cart;
				const WhatsAppAPI = window.WhatsApp;
				const currencySymbol = typeof window.currency === 'string' ? window.currency : 'â‚¹';
				const FALLBACK_IMAGE = 'assets/images/placeholder.jpg';
				let renderedCartItems = [];
				let productCache = null;

				const notify = (type, message, duration = 6000) => {
					const alertApi = window.Alert;
					if (alertApi && typeof alertApi[type] === 'function') {
						alertApi[type](message, duration);
						return;
					}
					if (alertApi && typeof alertApi.show === 'function') {
						alertApi.show(message, type, duration);
						return;
					}
					if (typeof window.showAlert === 'function') {
						window.showAlert(message, type, duration);
						return;
					}
					window.alert(message);
				};

				if (!CartAPI) {
					console.error('Cart module failed to load. Cart page scripts aborted.');
					return;
				}

				const ProductDB = {
					async getAllProducts() {
						if (Array.isArray(productCache)) {
							return productCache;
						}

						try {
							const response = await fetch('data/products.json', { cache: 'no-cache' });
							if (!response.ok) {
								throw new Error(`Failed to fetch products: ${response.status}`);
							}
							productCache = await response.json();
						} catch (error) {
							console.error('Failed to fetch products:', error);
							productCache = [];
						}

						return productCache;
					}
				};

				const formatCurrency = (value) => (Number(value) || 0).toLocaleString('en-IN');

				const getPrimaryImage = (product) => {
					if (product && Array.isArray(product.images) && product.images.length > 0) {
						return product.images[0];
					}
					return FALLBACK_IMAGE;
				};

				async function loadCart() {
					const storedCart = CartAPI.getCart();
					const cart = Array.isArray(storedCart) ? storedCart : [];

					if (!cart.length) {
						renderedCartItems = [];
						toggleCartVisibility(false);
						updateCartSummary([]);
						return;
					}

					const allProducts = await ProductDB.getAllProducts();

					renderedCartItems = cart
						.map((rawItem) => {
							if (!rawItem) return null;

							const quantity = Math.max(0, Number(rawItem.quantity) || 0);
							if (quantity === 0) return null;

							const rawId = rawItem.id;
							const matchedProduct = allProducts.find((product) => String(product.id) === String(rawId));

							if (matchedProduct) {
								return {
									id: rawId,
									quantity,
									name: matchedProduct.name,
									sku: matchedProduct.sku,
									price: Number(matchedProduct.sellingPrice || matchedProduct.price) || 0,
									image: getPrimaryImage(matchedProduct)
								};
							}

							if (rawItem.name || rawItem.price) {
								return {
									id: rawId,
									quantity,
									name: rawItem.name || `Product ${rawId}`,
									sku: rawItem.sku || 'N/A',
									price: Number(rawItem.price) || 0,
									image: rawItem.image || FALLBACK_IMAGE
								};
							}

							return null;
						})
						.filter(Boolean);

					toggleCartVisibility(renderedCartItems.length > 0);
					displayCartItems(renderedCartItems);
					updateCartSummary(renderedCartItems);
				}

				function toggleCartVisibility(hasItems) {
					const emptyState = document.getElementById('empty-cart');
					const cartSection = document.getElementById('cart-items');
					const list = document.getElementById('cart-items-list');

					if (!emptyState || !cartSection || !list) return;

					if (hasItems) {
						emptyState.classList.add('hidden');
						cartSection.classList.remove('hidden');
					} else {
						emptyState.classList.remove('hidden');
						cartSection.classList.add('hidden');
						list.innerHTML = '';
					}
				}

				function displayCartItems(items) {
					const container = document.getElementById('cart-items-list');
					if (!container) return;

					container.innerHTML = items
						.map((item) => {
							const itemIdAttr = String(item.id).replace(/"/g, '&quot;');

							return `
								<div class="p-4 sm:p-6 flex flex-col sm:flex-row gap-4 hover:bg-gray-50 transition-colors" data-cart-row="${itemIdAttr}">
									<a href="product.html?id=${itemIdAttr}" class="flex-shrink-0 group/img">
										<img src="${item.image || FALLBACK_IMAGE}" alt="${item.name}" class="w-20 h-20 sm:w-24 sm:h-24 object-contain rounded-lg border border-gray-200 group-hover/img:border-primary transition-colors" />
									</a>
									<div class="flex-1 min-w-0 overflow-hidden">
										<a href="product.html?id=${itemIdAttr}" class="block group/name">
											<h3 class="font-bold text-sm sm:text-base text-gray-900 mb-1 line-clamp-2 group-hover/name:text-primary transition-colors">${item.name}</h3>
										</a>
										<p class="text-xs sm:text-sm text-gray-500 mb-2">SKU: ${item.sku}</p>
										<div class="flex flex-wrap items-center gap-2 sm:gap-4">
											<span class="text-lg sm:text-xl font-bold text-primary whitespace-nowrap">${currencySymbol}${formatCurrency(item.price)}</span>
											<span class="text-xs sm:text-sm text-gray-500">per unit</span>
										</div>
									</div>
									<div class="flex sm:flex-col items-center sm:items-end justify-between sm:justify-start gap-4">
										<div class="flex items-center gap-3 bg-gray-100 rounded-lg p-1">
											<button type="button" class="w-8 h-8 flex items-center justify-center bg-white rounded hover:bg-primary hover:text-white transition-colors" data-cart-action="decrement" data-cart-id="${itemIdAttr}">
												<span class="material-symbols-rounded text-lg">remove</span>
											</button>
											<span class="w-8 text-center font-bold">${item.quantity}</span>
											<button type="button" class="w-8 h-8 flex items-center justify-center bg-white rounded hover:bg-primary hover:text-white transition-colors" data-cart-action="increment" data-cart-id="${itemIdAttr}">
												<span class="material-symbols-rounded text-lg">add</span>
											</button>
										</div>
										<button type="button" class="p-2 text-red-600 hover:bg-red-50 rounded-lg transition-colors" title="Remove item" data-cart-action="remove" data-cart-id="${itemIdAttr}">
											<span class="material-symbols-rounded">delete</span>
										</button>
									</div>
								</div>
							`;
						})
						.join('');

					const totalItems = items.reduce((sum, item) => sum + Number(item.quantity || 0), 0);
					const totalItemsEl = document.getElementById('total-items');
					if (totalItemsEl) {
						totalItemsEl.textContent = totalItems;
					}
				}

				function updateCartSummary(items) {
					const subtotal = items.reduce((sum, item) => {
						const price = Number(item.price) || 0;
						const qty = Number(item.quantity) || 0;
						return sum + price * qty;
					}, 0);

					// Calculate delivery charges based on subtotal
					let deliveryCharge = 299; // Standard delivery
					let originalDeliveryCharge = 299;
					let deliverySavings = 0;
					let deliveryStatus = 'standard'; // standard, discounted, or free

					if (subtotal >= 4999) {
						deliveryCharge = 0;
						deliverySavings = 299;
						deliveryStatus = 'free';
					} else if (subtotal >= 1999) {
						deliveryCharge = 199;
						deliverySavings = 100;
						deliveryStatus = 'discounted';
					}

					const total = subtotal + deliveryCharge;

					// Update subtotal
					const subtotalEl = document.getElementById('subtotal');
					if (subtotalEl) subtotalEl.textContent = formatCurrency(subtotal);

					// Update delivery charge display
					const deliveryChargeEl = document.getElementById('delivery-charge');
					const deliveryChargeOriginalEl = document.getElementById('delivery-charge-original');
					const deliverySavingsEl = document.getElementById('delivery-savings');
					const deliverySavingsTextEl = document.getElementById('delivery-savings-text');
					const deliveryInfoEl = document.getElementById('delivery-info');

					if (deliveryChargeEl) {
						if (deliveryStatus === 'free') {
							deliveryChargeEl.textContent = 'FREE';
							deliveryChargeEl.className = 'text-green-600 font-bold';
							if (deliveryChargeOriginalEl) {
								deliveryChargeOriginalEl.textContent = 'â‚¹' + formatCurrency(originalDeliveryCharge);
								deliveryChargeOriginalEl.classList.remove('hidden');
							}
						} else if (deliveryStatus === 'discounted') {
							deliveryChargeEl.textContent = 'â‚¹' + formatCurrency(deliveryCharge);
							deliveryChargeEl.className = 'text-green-600 font-bold';
							if (deliveryChargeOriginalEl) {
								deliveryChargeOriginalEl.textContent = 'â‚¹' + formatCurrency(originalDeliveryCharge);
								deliveryChargeOriginalEl.classList.remove('hidden');
							}
						} else {
							deliveryChargeEl.textContent = 'â‚¹' + formatCurrency(deliveryCharge);
							deliveryChargeEl.className = 'text-gray-900 font-semibold';
							if (deliveryChargeOriginalEl) {
								deliveryChargeOriginalEl.textContent = '';
								deliveryChargeOriginalEl.classList.add('hidden');
							}
						}
					}

					// Update delivery savings badge
					if (deliverySavingsEl && deliverySavingsTextEl) {
						if (deliveryStatus === 'free') {
							deliverySavingsTextEl.textContent = `You saved â‚¹${deliverySavings} on delivery! ðŸŽ‰`;
							deliverySavingsEl.classList.remove('hidden');
						} else if (deliveryStatus === 'discounted') {
							const amountNeeded = 4999 - subtotal;
							deliverySavingsTextEl.textContent = `You saved â‚¹${deliverySavings}! Add â‚¹${formatCurrency(amountNeeded)} more for FREE delivery`;
							deliverySavingsEl.classList.remove('hidden');
						} else {
							deliverySavingsEl.classList.add('hidden');
						}
					}

					// Update tooltip
					if (deliveryInfoEl) {
						if (deliveryStatus === 'free') {
							deliveryInfoEl.title = 'FREE delivery on orders â‰¥ â‚¹4,999';
						} else if (deliveryStatus === 'discounted') {
							const amountNeeded = 4999 - subtotal;
							deliveryInfoEl.title = `â‚¹199 delivery (â‚¹100 off). Add â‚¹${formatCurrency(amountNeeded)} more for FREE delivery`;
						} else {
							const amountNeeded = 1999 - subtotal;
							deliveryInfoEl.title = `â‚¹299 standard delivery. Add â‚¹${formatCurrency(amountNeeded)} more to save â‚¹100`;
						}
					}

					// Update total
					const totalEl = document.getElementById('total');
					if (totalEl) totalEl.textContent = formatCurrency(total);

					// Show/hide prepaid promo card based on cart items
					const prepaidPromoCard = document.getElementById('prepaid-promo-card');
					if (prepaidPromoCard) {
						if (items.length > 0) {
							prepaidPromoCard.classList.remove('hidden');
						} else {
							prepaidPromoCard.classList.add('hidden');
						}
					}
				}

				function handleCartListClick(event) {
					const actionButton = event.target.closest('[data-cart-action]');
					if (!actionButton) return;

					event.preventDefault();

					const action = actionButton.getAttribute('data-cart-action');
					const cartId = actionButton.getAttribute('data-cart-id');
					if (!action || !cartId) return;

					const item = renderedCartItems.find((entry) => String(entry.id) === cartId);
					if (!item) return;

					if (action === 'increment') {
						CartAPI.updateItemQuantity(item.id, Number(item.quantity) + 1);
					} else if (action === 'decrement') {
						CartAPI.updateItemQuantity(item.id, Number(item.quantity) - 1);
					} else if (action === 'remove') {
						CartAPI.removeItem(item.id);
					}

					loadCart();
				}

				async function openCheckoutModal() {
					if (!renderedCartItems.length) {
						notify('info', 'Your cart is empty! Please add some products before checking out.');
						return;
					}

					const modalItems = document.getElementById('modal-order-items');
					if (modalItems) {
						modalItems.innerHTML = renderedCartItems
							.map((item) => `
								<div class="flex justify-between text-sm">
									<span class="text-gray-700">${item.name} Ã— ${item.quantity}</span>
									<span class="font-semibold text-gray-900">${currencySymbol}${formatCurrency(item.price * item.quantity)}</span>
								</div>
							`)
							.join('');
					}

					const total = renderedCartItems.reduce((sum, item) => sum + (Number(item.price) || 0) * (Number(item.quantity) || 0), 0);
					const modalTotal = document.getElementById('modal-total');
					if (modalTotal) {
						modalTotal.textContent = formatCurrency(total);
					}

					const checkoutModal = document.getElementById('checkout-modal');
					if (checkoutModal) {
						checkoutModal.classList.remove('hidden');
					}
					document.body.style.overflow = 'hidden';
				}

				function closeCheckoutModal() {
					const checkoutModal = document.getElementById('checkout-modal');
					if (checkoutModal) {
						checkoutModal.classList.add('hidden');
					}
					document.body.style.overflow = '';
				}

				async function handleCheckout(event) {
					event.preventDefault();

					if (!renderedCartItems.length) {
						notify('info', 'Your cart is empty! Please add some products before checking out.');
						return;
					}

					const formData = new FormData(event.target);
					let message = `ðŸ›’ *NEW ORDER FROM FINGAURD WEBSITE*\n\n`;
					message += `ðŸ‘¤ *Customer Details:*\n`;
					message += `Name: ${formData.get('name')}\n`;
					message += `Phone: ${formData.get('phone')}\n\n`;
					message += `ðŸ“ *Delivery Address:*\n`;
					message += `${formData.get('address')}\n`;
					message += `${formData.get('city')}, ${formData.get('state')} - ${formData.get('pincode')}\n\n`;

					const family = formData.get('family');
					const water = formData.get('water');
					if (family || water) {
						message += `â„¹ï¸ *Additional Info:*\n`;
						if (family) message += `Family Size: ${family}\n`;
						if (water) message += `Water Source: ${water}\n`;
						message += `\n`;
					}

					message += `ðŸ›ï¸ *Order Items:*\n`;
					renderedCartItems.forEach((item, index) => {
						const lineTotal = (Number(item.price) || 0) * (Number(item.quantity) || 0);
						message += `${index + 1}. ${item.name}\n`;
						message += `   SKU: ${item.sku}\n`;
						message += `   Qty: ${item.quantity} Ã— ${currencySymbol}${formatCurrency(item.price)} = ${currencySymbol}${formatCurrency(lineTotal)}\n\n`;
					});

					const total = renderedCartItems.reduce((sum, item) => sum + (Number(item.price) || 0) * (Number(item.quantity) || 0), 0);
					message += `ðŸ’° *Total Amount: ${currencySymbol}${formatCurrency(total)}*\n`;
					message += `âœ… Free Delivery â€¢ Free Installation â€¢ 1 Year Warranty\n\n`;

					const notes = formData.get('notes');
					if (notes) {
						message += `ðŸ“ *Order Notes:*\n${notes}\n\n`;
					}

					message += `---\n`;
					message += `Order placed from: ${window.location.origin}\n`;
					message += `Date: ${new Date().toLocaleString('en-IN')}`;

					if (WhatsAppAPI && typeof WhatsAppAPI.send === 'function') {
						WhatsAppAPI.send(message);
					} else {
						console.error('WhatsApp module is unavailable. Unable to send checkout message.');
					}

					notify('success', 'ðŸŽ‰ Your order has been sent via WhatsApp! Our team will contact you shortly to confirm your order.');

					CartAPI.clearCart();
					closeCheckoutModal();
					loadCart();
				}

				document.addEventListener('DOMContentLoaded', () => {
					loadCart();

					const cartItemsList = document.getElementById('cart-items-list');
					if (cartItemsList) {
						cartItemsList.addEventListener('click', handleCartListClick);
					}

					const checkoutBtn = document.getElementById('checkout-btn');
					if (checkoutBtn) {
						checkoutBtn.addEventListener('click', openCheckoutModal);
					}

					const closeModalBtn = document.getElementById('close-modal');
					if (closeModalBtn) {
						closeModalBtn.addEventListener('click', closeCheckoutModal);
					}

					const checkoutForm = document.getElementById('checkout-form');
					if (checkoutForm) {
						checkoutForm.addEventListener('submit', handleCheckout);
					}

					const checkoutModal = document.getElementById('checkout-modal');
					if (checkoutModal) {
						checkoutModal.addEventListener('click', (event) => {
							if (event.target === checkoutModal) {
								closeCheckoutModal();
							}
						});
					}
				});
			})();
		</script>

		<script type="module" src="/js/app.js"></script>
	</body>
</html>
